## 데드락(DeadLock) 이란?

- 프로세스가 자원을 얻지 못해 다음 처리를 하지 못하는 상태, 교착 상태라고도 함
- 시스템적으로 한정된 자원을 여러 곳에서 사용하려고 할 때 발생



### 데드락이 발생할 수 있는 경우

![1](https://user-images.githubusercontent.com/44665707/150237663-5c7aba3d-7e26-4139-864f-8500f6ad859f.PNG)

- P1과  P2가 리소스 1, 2 둘 다를 얻어야 한다고 가정할 때, P1이 리소스 1을 얻고 P2가 리소스 2를 얻었다면다음 요청때 P1은 리소스 2를, P1은 리로스 1을 기다리게 됨

- 하지만 서로 원하는 리소스가 상대방에게 할당돼있기 때문에 프로세스가 무한정으로 기다리게 됨



### 데드락의 발생 조건

1. 상호 배재(Mutual Exclusion) : 자원은 한 번에 한 프로세스만이 사용 할 수 있어야 함
2. 점유 대기(Hold and Wait) : 최소한 하나의 자원을 점유하고 있으면서 다른 프로세스에 할당되어 사용하고 있는 자원을 추가로 점유하기 위해 대기하는 프로세스가 있어야 한다
3. 비선점(No Preemption) : 다른 프로세스에 할당된 자원은 사용이 끝날 때까지 강탈할수 없어야 한다
4. 순환 대기(Circular wait) : 프로세스의 집합에서 순환 형태로 자원을 대기하고 있어야 한다

- 4가지가 모두 성립해야 데드락이 발생함



### 데드락 처리

1. 교착 상태 발생하지 않도록 예방(prevention)
2. 교착 상태 발생 가능성을 인정하면서 적절히 회피(avoidance)
3. 교착 상태 발생을 허용하지만 이를 탐지(detection)하고 회복(recovery)



### 데드락 예방

- 위의 발생 조건 4가지 중에 하나라도 발생하지 않게 하기

1. 자원의 상호 배제 조건 방지 : 한 번에 여러 프로세스가 공유 자원을 사용 할 수 있게하기, 하지만 추후 동기화 관련 문제 발생 가능성 있음
2. 점유 대기 조건 방지 : 프로세스 실행에 필요한 모든 자원을 한꺼번에 요구하고 허용할 때 까지 작업을 보류해서, 나중에 또다른 자원을 점유하기 위한 대기 조건을 성립하지 않도록 하기
3. 비선점 조건 방지 : 이미 다른 프로세스에게 할당된 자원이 선점권이 없다고 가정할 때, 높은 우선순위의 프로세스가 해당 자원을 선점할 수 있도록 하기
4. 순환 대기 조건 방지 : 자원을 순환 형태로 대기하지 않도록 일정한 한 쪽 방향으로만 자원을 요구할수 있도록 하기

- 하지만 이러한 방법들은 시스템의 처리량, 효율성을 떨어트릴 수 있음



### 데드락 회피

- 시스템의 프로세스들이 요청하는 모든 자원을, 데드락을 발생시키지 않으면서 모두에게 차례로 할당 해 줄 수 있다면 안정 상태(safe state)에 있다고 함
- 데드락이 발생하지 않는 순서를 찾는다면 이를 안전 순서(safe sequence)라고 부름
- 데드락 회피는 자원을 할당한 후에도 시스템이 항상 safe satate에 있을 수 있게 할당을 허용하자는 것

- 은행원 알고리즘 : 다익스트라가 제안한 기법, 미리 결정된 모든 자원들의 최대 할당량을 가지고 시뮬레이션 하여 safe state에 들 수 있는지 여부를 검사 하는 것

![2](https://user-images.githubusercontent.com/44665707/150238768-eaf84ce5-e5c6-4699-96e7-b226e5f48cbf.PNG)

- P0~P2는 프로세스이고, Max는 프로세스당 최대 자원 요청량, Allocation은 현재 프로세스에 할당 중인 자원량, Need는 남은 자원의 양
- t0일때 할당된 자원의 합은 9개이고 Available한 자원은 3개
- 이때 <P1, P0, P2> 일때가 안전 순서
- 이처럼 미리 최대 자원 요구량을 알야아 하고, 할당할 수있는 자원수가 일정해야 하는 등 제약 조건이 많음



### 데드락 탐지 및 회복

- 탐지 기법 : Allocation, Request, Available 등으로 시스템에 데드락이 발생했는지 여부를 탐색, 은행원 알고리즘의 방식과 비슷, 자원 할당 그래프 통해서도 탐지 가능
- 회복 기법 : 탐지를 통해 발견했다면, 데드락으로부터 회복하기 위한 방법을 사용
  - 프로세스 1개 이상 중단 : 교착 상태에 빠진 모든 프로세스 중산시키기, 프로세스를 하나씩 중단 시킬 때마다 탐지 알고리즘으로 데드락을 탐지하면서 회복하기
  - 자원 선점하기

