## 운영체제란

시스템의 자원과 동작을 관리하는 소프트웨어



### 운영체제의 목적(성능평가 기준)

처리능력 향상 - 일정 시간 내에 시스템이 처리하는 일의 양

사용가능도 향상  - 시스템을 사용할 필요가 있을 때 즉시 사용 가능한 정도

신뢰도 향상 - 주어진 문제를 정확하게 해결하는 정도

반환시간 단축 - 시스템에 작업을 의뢰한 시간부터 처리가 완료될 때까지 걸린 시간



### 운영체제의 기능

- 프로세서, 기억장치 등 자원 관리

- 자원의 스케줄링 기능 제공

- 편리한 인터페이스 제공

- 하드웨어와 네트워크 관리, 제어

- 데이터 관리 및 자원의 공유 기능 제공

- 시스템의 오류를 검사하고 복구

- 자원보호기능 제공

- 입출력에 대한 보조 기능 제공

- 가상 계산기 능력 제공
  - 가상계산기란 한대의 컴퓨터를 여러 컴퓨터처럼 보이게 하는 방법



### 운영체제의 주요 자원 관리

- 프로세스관리 - 프로세스 스케줄링 및 동기화 관리 담당, 프로세스 생성과 제거, 메세지 전달 등 기능 담당

- 기억장치관리 - 프로세스에게 메모리 할당 및 회수 관리 담당

- 주변장치관리 - 입 출력 장치 스케줄링 및 전반적인 관리 담당

- 파일관리 - 파일의 생성과 삭제, 변경, 유지 등 관리 담당



### 프로세스와 스레드

- 프로세스 - 실행되고 있는 컴퓨터 프로그램

- 스레드 - 프로세스가 할당 받은 자원을 이용하는 실행 흐름의 단위

- 프로세스 = 실행중인 프로그램/ 스레드 = 프로세스 분기 처리



### 프로세스와 스레드 메모리 개념

![메모리 개념](https://camo.githubusercontent.com/3dc4ad61f03160c310a855a4bd68a9f2a2c9a4c7/68747470733a2f2f74312e6461756d63646e2e6e65742f6366696c652f746973746f72792f393938383931343635433637433330363036)

##### Code

- text 영역

- 실행할 프로그램의 코드가 저장됨

- CPU는 이 영역에 저장된 명령어를 하나씩 가져와 수행

- 프로그램이 시작되고 끝날 때까지 메모리 영역에 유지

##### Data

- 전역변수와 정적변수가 저장됨

- 프로그램 시작 떄 할당되고 종료될 때 해제됨

- BSS와 GVAR영역을 통틀어 data영역이라 함

  - BSS : 초기화가 되지 않은 데이터를 저장

  - GVAR : 초기화가 된 데이터를 저장하기 위한 영역

##### Heap

- 프로그래머에 의해 할당되고 해제됨

- 메모리를 동적으로 할당할 때 사용되는 메모리 영역

##### Stack

- 프로그램에 의해 사용되는 임시 데이터 영역

- 함수 호출시 생성되는 지역변수, 매개변수를 저장

- 메모리 주소는 높은 곳에서 낮은 곳의 방향으로 할당



### 멀티 프로세스와 멀티 스레드

##### 멀티 프로세스 - 하나의 프로그램을 여러개의 프로세스로 구성하여 각 프로세스가 하나의 작업을 처리하는 것

- 장점 : 하나의 프로세스가 잘못 되어도 프로그램이 동작함(안정적)

- 단점 : context switching으로 성능 저하, 각각 독립된 메모리를 갖고 있어 작업량이 많을 수록 오버헤드 발생

##### Context switching

CPU에서 여러 프로세스를 돌아가면서 작업을 처리하는 과정

##### 멀티 스레드 - 프로그램을 여러개의 쓰레드로 구성하고 각 쓰레드가 작업을 처리하는것

- 장점 : 공유 메모리만큼의 시간, 자원 손실 감소

- 단점 : 디버깅이 어려움, 동기화 이슈 발생, 하나의 스레드의 오류로 전체 프로세스에 문제 발생(공유 메모리 문제)
- 문제해결을 위해 Critical Section 사용
  - Critical Section - 스레드가 동시 접근을 못하는 공유 구역

## 인터럽트(Interrupt)

하드웨어 등의 장치에 예외상황이 발생하여 처리가 필요할 경우에 현재 실행중인 작업을 중단하고 CPU에 알려 처리할 수 있도록 하는 것

### 인터럽트의 종류

##### 외부인터럽트

- 전원 이상 인터럽트

- 정전, 파워 이상 등

- 기계 착오 인터럽트

- CPU의 기능적인 오류

- 외부 신호 인터럽트

  - 타이머에 의한 인터럽트 : 선점 개념

  - 키보드로 인터럽트 키를 누른 경우 : CTRL + ALT + DEL

  - 외부장치로부터 인터럽트 요청이 있는 경우

- 입출력 인터럽트

  - 입출력 데이터에 이상이 있는 경우

  - 데이터 전송을 요구하거나 전송이 끝나 다음 동작이 수행되어야 할 경우

##### 내부인터럽트

- 잘못된 명령이나 잘못된 데이터를 사용할 때 발생하며 Trap이라 부름

- 프로그램 검사 인터럽트

  - Division by zero(0으로 나누기)

  - 언더/오버 플로우

  - 기타 예외상황

##### 소프트웨어 인터럽트

- 사용자가 프로그램을 실행시키거나 감시프로그램을 호출하는 동작을 수행

- 소프트웨어 이용 중 다른 프로세스를 실행시키면 시분할 처리를 위해 자원 할등 등의 동작 수행

### 인터럽트 발생 시 처리 순서

1. 인터럽트 요청 신호 발생

2. 프로그램 실행 중단

3. 현재 프로그램 상태 보존(복귀 주소를 Stack에 저장)

4. 인터럽트 처리 루틴 실행(문제 파악)

5. 인터럽트 서비스 루틴 실행(문제 해결)

6. 상태 복구가 중단된 프로그램 재실행

### 인터럽트 우선 순위

- 여러 장치에서 인터럽트가 동시에 발생하거나 인터럽트 서비스 루틴 수행 중 인터럽트가 발생한 경우 우선순위 판별 필요

1. 전원 이상
2. 기계 착오
3. 외부 신호
4. 입출력
5. 명령어 잘못
6. 프로그램 검사
7. SVC(SuperVisor Call)

일반적으로 외부 > 내부/ 하드웨어 > 소프트웨어



### 우선순위 판별 방법

##### 소프트웨어적인 방법(폴링)

- Polling - 다른 장치의 상태를 주기적으로 검사, 일정한 조건 만족시 자료 처리하는 방식

인터럽트 요청 플래그를 차례로 비교하여 우선순위가 가장 높은 인터럽트 자원을 찾고, 이에 해당하는 인터럽트 서비스 루틴을 수행

속도가 빠른 장치에 높은 등급 비교

우선순위 변경이 쉬움

많은 인터럽트가 있을 경우 하드웨어 적인 방법에 비해서 우선순위 판단속도가 느림

회로가 간단하고 융통성이 있으며, 별도에 하드웨어가 필요 없음

Polling의 주기가 짧으면 서버 성능에 부담이 생기며, 주기가 길면 실시간성이 떨어짐

##### 하드웨어적인 방법

- Vectored Interrupt

  - 인터럽트를 요청할 수 있는 장치와 CPU사이에 장치번호를 식별할 버스를 직렬/병렬로 연결함

  - 인터럽트 벡터는 인터럽트가 발생한 장치가 분기할 곳에 대한 정보

  - 소프트웨어적인 방법에 비해 비 경제적임

  - 회로가 복잡하나 속도가 빠름

##### Daisy Chain - 직렬 우선순위 부여 방식

- 인터럽트가 발생하는 모든 장치를 한개의 회선에 직렬로 연결

- 우선순위가 높은 장치를 상위에 두고 우선순위대로 배치

##### 병렬 우선순위 부여 방식

- 인터럽트가 발생하는 모든 장치를 하나의 직렬 회선으로 연결

- 각 장치별 우선 순위를 판별하기 위한 Mask register에 bit설정

- 레지스터 상 우선순위가 높은 서비스 루틴 수행중 우선 순위가 낮은 bit들을 비활성화 시킴

- 반대로 우선순위가 높은 인터럽트는 낮은 인터럽트 수행 중에도 우선 처리됨
  - Mask register - 끼어들기의 허용 또는 금지를 제어하는 레지스터

##### 특징 비교

| 비교항목             | 하드웨어 | 소프트웨어 |
| -------------------- | -------- | ---------- |
| 반응 속도            | 고속     | 저속       |
| 회로 복잡도          | 복잡     | 간단       |
| 경제성               | 비경제적 | 경제적     |
| 융통성(우선순위변경) | 없음     | 있음       |

[참조]

https://coding-factory.tistory.com/300

https://www.byfuls.com/programming/read?id=61

https://brunch.co.kr/@babosamo/100

https://velog.io/@raejoonee/%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%EC%99%80-%EC%8A%A4%EB%A0%88%EB%93%9C%EC%9D%98-%EC%B0%A8%EC%9D%B4

https://raisonde.tistory.com/entry/%EC%9D%B8%ED%84%B0%EB%9F%BD%ED%8A%B8Interrupt%EC%9D%98-%EA%B0%9C%EB%85%90%EA%B3%BC-%EC%A2%85%EB%A5%98

https://itwiki.kr/w/%EC%9D%B8%ED%84%B0%EB%9F%BD%ED%8A%B8

https://devkim93.tistory.com/entry/%EC%9D%B8%ED%84%B0%EB%9F%BD%ED%8A%B8-%EC%9A%B4%EC%84%A0%EC%88%9C%EC%9C%84Priority-%EC%B2%B4%EC%A0%9C