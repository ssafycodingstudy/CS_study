# 16주차 CS 발표

## 테스트 주도 개발 (TDD)

### TDD란?

TDD란 `Test Driven Development`의 약자로 **테스트 주도 개발**이라고 함

반복 테스트를 이용한 소프트웨어 방법론으로, 작은 단위의 테스트 케이스를 작성하고 이를 통과하는 코드를 추가하는 단계를 반복하여 구현함

짧은 개발 주기의 반복에 의존하는 개발 프로세스이며, 애자일 방법론 중 하나인 eXtream Programming(XP)의 'Test-First' 개념에 기반을 둔 단순한 설계를 중요시함

> **eXtream Programming(XP)란?**
>
> 미래에 대한 예측을 최대한 하지 않고 지속적으로 프로토타입을 완성하는 애자일 방법론중 하나임
>
> 이 방법론은 추가 요구사항이 생기더라도 실시간으로 반영할 수 있음

> **단위 테스트(unit Test)란?**
>
> 말 그대로 한 단위(일반적으로 class)만을 테스트하는 것



### TDD 개발주기

<img src="https://i0.wp.com/hanamon.kr/wp-content/uploads/2021/04/TDD-%E1%84%80%E1%85%A2%E1%84%87%E1%85%A1%E1%86%AF%E1%84%8C%E1%85%AE%E1%84%80%E1%85%B5.png?resize=1024%2C680&ssl=1" alt="TDD-개발주기" style="zoom:50%;" />

위 그림은 TDD의 개발 주기를 표현한 것

- `Red` 단계에서는 실패하는 테스트 코드를 먼저 작성함
- `Green` 단계에서는 테스트코드를 성공시키기 위한 실제 코드를 작성함
- `Blue` 단계에서는 중복코드 제거, 일반화 등의 리팩토링을 수행함

중요한 것은 실패하는 테스트 코드를 작성할 때까지 실제 코드를 작성하지 않는 것과, 실패하는 테스트를 통과할 정도의 최소 실제 코드를 작성해야하는 것

이를 통해 실제 코드에 대해 기대되는 바를 보다 명확하게 정의함으로써 불필요한 설계를 피할 수 있고, 정확한 요구 사항에 집중할 수 있음



### 일반 개발 방식과 TDD 개발 방식의 비교

#### 일반 개발 방식

보통 개발 방식은 `요구사항 분석` → `설계` → `테스트` → `배포`  형태의 개발 주기를 가짐

![기존프로세스](https://i0.wp.com/hanamon.kr/wp-content/uploads/2021/04/%E1%84%80%E1%85%B5%E1%84%8C%E1%85%A9%E1%86%AB%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%89%E1%85%A6%E1%84%89%E1%85%B3.png?resize=514%2C114&ssl=1)

이러한 방식은 소프트웨어 개발을 느리게하는 잠재적 위험이 존재함

이러한 문제점이 발생되는 이유는 어느 프로젝트든 **초기 설계가 완벽하다고 말할 수 없기 때문**

고객의 요구사항 또는 디자인의 오류 등 많은 외부/내부 조건에 의해 재설계하여 점진적으로 완벽한 설계로 나아감

재설계로 인해 개발자는 코드를 삽입, 수정, 삭제하는 과정에서 불필요한 코드가 남거나 중복될 가능성이 큼

결론적으로 이러한 코드들은 **재사용이 어렵고 관리가 어려워서 유지보수를 어렵게 만듦**

작은 부분의 기능 수정에도 모든 부분을 테스트해야하므로 전체적인 버그 검출이 어려워짐. 따라서 **자체 버그 검출 능력이 저하**됨. 그 결과 어디서 버그가 발생할지 모르기 때문에 잘못된 코드도 고치지 않으려하는 현상이 나타남

이 현상은 **소스 코드의 품질 저하와 직결**됨. 작은 수정에도 모든 기능을 다시 테스트해야하는 문제가 발생하여 **자체 테스트 비용이 증가함**



#### TDD 개발 방식

TDD와 일반적인 개발 방식의 가장 큰 차이점은 테스트 코드를 작성한 뒤에 실제 코드를 잘성한다는 것

디자인(설계) 단계에서 프로그래밍 목적을 반드시 미리 정의해야만 하고, 무엇을 테스트 해야할지 미리 정의(테스트 케이스 작성)해야만 함

테스트 코드를 작성하는 도중 발생하는 예외 사항(버그 및 수정사항)은 테스트케이스에 추가하고 설계를 개선함

이후 테스트가 통과된 코드만을 코드 개발 단계에서 실제 코드로 작성함

![TDD프로세스](https://i0.wp.com/hanamon.kr/wp-content/uploads/2021/04/TDD%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%89%E1%85%A6%E1%84%89%E1%85%B3.png?resize=528%2C165&ssl=1)

> 이러한 반복적인 단계가 진행되면서 자연스럽게 코드의 버그가 줄어들고 소스코드는 간결해짐

또한 테스트 케이스 작성으로 인해 자연스럽게 설계가 개선됨으로 재설계 시간이 절감됨



### TDD의 대표적인 Tool 'JUnit'

#### JUnit이란?

JUnit은 현재 전 세계적으로 가장 널리 사용되는 `Java 단위 테스트 프레임워크`

에릭 감마와 켄트 벡이 탄생시킴. 

JUnit을 시작으로 CUnit(C언어), CPPUnit(C++), PyUnit(Python) 등 xUnit 프레임워크가 탄생하게 되었음

> **xUnit이란?**
>
> 자바의 단위 테스팅 프레임워크인 JUnit만 있는 것은 아님
>
> 다른 언어도 단위 테스트를 위한 프레임워크가 존재하며 보통 이름을 xUnit이라 지칭함



### TDD 개발방식의 장점

#### 보다 튼튼한 객체 지향적인 코드 생산

TDD는 코드의 재사용 보장을 명시하므로 TDD를 통한 소프트웨어 개발 시 기능별 철저한 모듈화가 이뤄짐

이는 종속성과 의존성이 낮은 모듈로 조합된 소프트웨어 개발을 가능하게 하며, 필요에 따라 모듈을 추가하거나 제거해도 소프트웨어 전체 구조에 영향을 미치지 않게 됨

#### 재설계 시간의 단축

테스트 코드를 먼저 작성하기 때문에 개발자가 지금 무엇을 해야하는지 분명히 정의하고 개발을 시작하게 됨.

또한 테스트 시나리오를 작성하면서 다양한 예외사항에 대해 생각해볼 수 있음. 이는 개발 진행 중 소프트웨어의 전반적인 설계가 변경되는 일을 방지할 수 있음

#### 디버깅 시간의 단축

이는 유닛 테스팅을 하는 이점이기도 함. 

예를 들면 사용자의 데이터가 잘못 나온다면 DB의 문제인지, 비즈니스 레이어의 문제인지, UI의 문제인지 실제 모든 레이어들을 전부 디버깅해야하지만, 

TDD의 경우 자동화된 유닛 테스팅을 전제하므로 특정 버그를 손쉽게 찾아낼 수 있음

#### 테스트 문서의 대체 가능

주로 SI 프로젝트 진행과정에서 어떤 요소들이 테스트 되었는지 테스트 정의서를 만듦. 이것은 단순 통합 테스트문서에 지나지 않음.

하지만 TDD를 하게 될 경우 테스팅을 자동화 시킴과 동시에 보다 정확한 테스트 근거를 산출할 수 있음

#### 추가 구현의 용이함

개발이 완료된 소프트웨어에 어떤 기능을 추가할 때 가장 우려되는 점은 해당 기능이 기존 코드에 어떤 영향을 미칠지 알지 못한 다는 것임

하지만 TDD의 경우 자동화된 유닛 테스팅을 전제하므로 테스트 기간을 획기적으로 단축시킬 수 있음



### TDD 개발방식의 단점

#### 생산성 저하

개발 속도가 느려진다고 생각하는 사람이 많기 때문에 TDD에 대해 반신반의함

왜냐하면 처음부터 2개의 코드를 짜야하고 중간중간 테스트를 하면서 고쳐나가야하기 때문

TDD 방식의 개발 시간은 일반적인 개발 방식에 비해 대략 10~30% 정도로 늘어남

SI 프로젝트에서는 소프트웨어의 품질보다는 납기일 준수가 훨씬 중요하기 때문에 TDD 방식을 잘 사용하지 않음



### TDD 접근 방법

- 가짜로 구현하기 : 최대한 빨리 테스트를 통과하기 위해 정답이 아닌 가짜 정답을 구현하는 방법
- 삼각측량법 : 값이 다른 여러 테스트를 작성하고, 이를 일반화하여 정답을 구현하는 방법
- 명백하게 구현하기 : 정답을 바로 구현하는 방법



#### 가짜로 구현하기

실패하는 테스트를 가장 빠르게 구현하는 방법은 아무 값이나 반환하도록 하는것임. 그리고 테스트가 통과하면 단계적으로 상수를 변수로 사용하도록 변형함

예를들어 다음과 같은 곱하기 테스트를 작성하였다고 가정

```java
@Test 
public void 곱하기테스트() { 
  // given 
  // when 
  final int result = multiply(2, 3); 
  // then 
  assertThat(result).isEqualTo(6); 
}
```

해당 테스트를 가장 빠르게 통과하는 방법은 6을 반환하는 것

```java
public int multiply(final int num1, final int num2) { 
	return 6; 
}
```

이렇게 변수를 사용하지 않고 상수를 반환하며, 답이 아닌 방법으로 가짜 구현하여 **최대한 빨리 테스트를 통과하는 것**이 가짜 구현 방법

가짜 구현으로 연습을 많이 해두면, 복잡한 코드일 경우에 단계를 잘게 쪼개서 TDD로 문제없이 개발하는 능력을 갖출 수 있음

가짜 구현으로 개발하면 다음과 같은 2가지 효과를 얻을 수 있음

- 심리학적 : 빨간 막대와 초록 막대 상태는 완전히 다름. 막대가 초록색이라면 어느 위치인지 알고 거기부터 리팩토링해 갈 수 있음
- 범위 조절 : 하나의 구체적인 예에서 일반화를 함으로써, 불필요한 고민으로 혼동되는 일을 예방할 수 있음



#### 삼각 측량

삼각 측량은 테스트 주도로 추상화된 과정을 일반화하는 과정임. 삼각 측량 방법은 테스트 예시가 2개 이상일 때에만 추상화를 해야함

```java
@Test public void 곱하기테스트() { 
  // given 
  // when 
  final int result1 = multiply(2, 3); 
  final int result2 = multiply(4, 7); 
  
  // then 
  assertThat(result1).isEqualTo(6); 
  assertThat(result2).isEqualTo(28); 
}
```



#### 명백하게 구현하기

명백하게 구현하는 방법은 가짜 구현이나 삼각 측량 방법을 사용하지 않고 바로 정답을 구현하는 방법임

현재 사용하는 곱하기와 같은 문제는 쉬우므로 다음과 같이 바로 진짜 구현을 해도 괜찮음

```java
public int multiply(final int num1, final int num2) { 
  return num1 * num2; 
}
```



### Spring에서의 TDD 프로그래밍 방법

- Repository → Service → Controller 순서로 개발을 진행함
- `Repository 계층`의 테스트는 H2와 같은 **인메모리 데이터베이스 기반의 통합 테스트**로 진행함
- `Service 계층`의 테스트는 **Mockito를 사용해 Repository 계층을 Mock**하여 진행함
- `Controller 계층`의 테스트는 **SpringTest의 MockMvc를 사용**해 진행함

(본문 작성자 개인적인 경험 바탕) Repository부터 계층을 작성해야 TDD의 flow가 매끄럽게 진행되는것 같음

왜냐하면 Repository 계층은 **다른 계층에 대한 의존성이 거의 없기 때문에**  먼저 작성하기가 편리함.



---

[참고1] : <https://hanamon.kr/tdd%EB%9E%80-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%A3%BC%EB%8F%84-%EA%B0%9C%EB%B0%9C/>

[참고 2] : <https://mangkyu.tistory.com/182>

