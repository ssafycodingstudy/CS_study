### SQL Injection이란?

- 악의적인 사용자가 보안상 취약점 이용, 임의의 SQL문을 주입하고 실행되게 하여 데이터베이스가 비정상적인 동작을 하게 하는 행위
- 공격이 쉬운 편이고 성공할 경우 큰 피해를 입힘

![image](https://user-images.githubusercontent.com/44665707/158543593-937e0079-6457-4320-8705-9b9ea2712be6.png)



### 종류 및 방법

## Error based SQL Injection

- 논리적 에러를 이용한 SQL Injection
- 가장 많이 쓰이고 대중적인 기법

![image](https://user-images.githubusercontent.com/44665707/158543733-9f0429ac-de15-44dd-935f-51681ff2a955.png)

1. 로그인 시 많이 사용되는 SQL 구문ㅇ ㅔ대해, 입력값에 대한 검증이 없음을 확인
2. 'OR 1 = 1 -- ' 을 통해 WHERE 절이 모두 참이되어 User 테이블의 모든 정보가 조회되고 가장 먼저 만들어진 계정으로 로그인 됨
3. 보통 관리자 계정이 제일 처음에 만들어지기 때문에 관리자 계정으로 로그인되고, 이를 통해 2차 피해 발생



## Union based SQL Injection

- Union 키워드는 두 개의 쿼리문에 대한 결과를 통합해서 하나의 테이블로 보여주는 키워드
- 정상적인 쿼리문에 Union 키워드 사용해 인젝션하여 원하는 쿼리문 실행 시킴
- 두 가지 조건이 필요한데, Union하는 두 테이블의 컬럼수가 같고, 데이터 형이 같아야 함

![image](https://user-images.githubusercontent.com/44665707/158544598-717f9c99-b2b9-4a7e-867c-931e06b708eb.png)

1. Board라는 테이블에서 게시글을 검색하는 쿼리문. 입력값을 title과 contents 컬럼의 데이터랑 비교한 뒤 비슷한 글자가 있는 게시글을 출력함
2. 입력값으로 Union 키워드와 함께 컬럼 수를 맞춰서 SELECT 구문을 넣어주게 되면 두 쿼리문이 합쳐져서 하나의 테이블로 보여짐

## Blind SQL Injection

### 1. Boolean base SQL

- 단순히 참과 거짓의 정보만 알 수 있을 때 사용
- 서버가 응답하는 로그인 성공, 실패 메시지를 이용해 DB의 테이블 정보 등을 추출 가능

![image](https://user-images.githubusercontent.com/44665707/158545025-445c19aa-1da9-40cb-b647-4c63bc4504d7.png)

1. 인젝션 가능한 로그인 폼 통해 사용자가 임의로 가입한 abc123 이라는 아이디로 인젝션 시도
2. 주입된 구문을 통해 단기간 내에 테이블 명을 알아낼 수 있음

### 2. Time base SQL

- 서버로부터 특정한 응답 대신 참 혹은 거짓의 응답 통해 데이터베이스 정보 유추하는 기법
- 사용되는 함수는 SLEEP과 BENCHMARK

![image](https://user-images.githubusercontent.com/44665707/158545546-8c27c03d-30f1-46ca-a83d-12b16a44cc33.png)

- 데이터베이스의 길이를 알아낼 수 있음



## Stored Procedure SQL Injection

- 저장 프로시저는 일련의 쿼리들을 모아 하나의 함수처럼 사용하는 것
- 윈도루 명령어를 사용하는 xp_cmdshell 프로시저를 공격하여 서버에 직접적 피해를 입힐수 있음



## Mass SQL Injection

- 한번의 공격으로 다량의 데이터베이스가 조작되어 큰 피해를 입히는 것
- MS-SQL을 사용하는 ASP 기반 웹 어플리케이션에 많이 사용
- 쿼리문은 HEX 인코딩 방식으로 인코딩 하여 공격
- 데이터베이스 값을 변조해 악성 스크립트를 삽입하고, 사용자들이 감염되게 하여 DDoS 공격에 사용



## 대응방안

1. 입력값에 대한 검증
   - 서버 단에서 화이트리스트 기반으로 검증
2. Prepared Statement 구문 사용
   - 사용자의 입력 값이 데이터베이스의 파라미터로 들어가기 전에 DBMS가 미리 컴파일 하여 실행하지 않고 대기. 그 후 사용자의 입력 값을 문자열로 인식하게 하여 공격쿼리가 들어간다 해도 사용자의 입력은 이미 의미없는 문자열이기 때문에 공격자 의도대로 작동 안함
3. Error Message 노출 금지