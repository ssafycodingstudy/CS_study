### 로드 밸런싱(부하 분산)이란?

- 둘 혹은 셋 이상의 중앙처리 장치 혹은 저장장치와 같은 컴퓨터 자원들에게 작업을 나누는 것
- 가용성 및 응답 시간 최적화 가능
- VLAN을 이용한 Layer 2 부하 분산, Routing Protocol을 이용한 Layer 3 분산, 서버 부하 분산 등이 존재



### 서버 부하 분산

![5](https://user-images.githubusercontent.com/44665707/154791889-d59a30c4-a28d-4f7b-8a04-fddd0db5559f.PNG)

- 외부의 사용자로부터 들어오는 다수의 요청을 서버들에게 적절히 배분해 처리케 하는 것
- 부하 분산 Network Switch 혹은 소프트웨어가 담당
- Network Switch를 L4/L7 Switch, Load Balancer라 부름
- 일반적으로 로드밸런싱이란 이 서버 부하 분산을 의미



### 왜 Load Balancer가 필요한가?

- 클라이언트가 많아질수록 Server에 대한 부하가 심해짐, 해결하기 위해 Scale-Up, Scale-out의 2가지 방법 존재
- Scale-Up : 서버가 더 빠르게 동작하기 위해 하드웨어 성능을 올림
- Scale-Out : 서버의 개수를 늘려 여러 대의 서버가 나눠 작업을 수행하는 방법
- Scale-Out 방식이 비용이 더 적고, 무중단 서비스를 운용하기 용이해 주로 채택, 이때 여러 대의 서버에게 균등하게 트래픽을 분산시키기 위해 Load Balancer 사용



### 서버 부하 분산의 방법

1. 라운드 로빈(Round Robin)
   - 다수의 서버에게 순서대로 요청을 할당, 가장 단순함
2. Lest Connection
   - 로드밸런서가 서버에 요청 전달, 사용자와 서버가 정상적인 연결을 맺으면 사용자와 서버는 커넥션 생성(3-way Handshake)
   - 이때의 커넥션 수 정보를 기반으로 가장 커넥션이 적은 서버, 즉 부하가 가장 덜한 서버로 요청을 전달
   - 트래픽으로 인해 세션이 길어지는 경우 권장
3. Ratio(가중치)
   - 서버의 처리 능력을 고려해 할당될 수 있는 서버가 가질 수 있는 커넥션의 비용을 정해두고, 이를 토대로 부하를 할당
4. Fastest
   - 응답속도가 가장 빠른 서버에게 우선적으로 할당하는 방법
5. Source
   - 사용자 IP를 해싱하여 분배하는 방식
   - 특정 사용자가 항상 서버로 연결되는 것을 보장



### 장애 대비

![6](https://user-images.githubusercontent.com/44665707/154792024-9ac301b2-8528-4129-ae8f-f38e37752960.PNG)

- 로드 밸런서를 이중화 하고, 각 로드 밸런서가 서로 상태를 체크함
- 메인 로드 밸런서가 동작하지 않으면, VIP(Virtual IP)는 여분의  로드 밸런서로 변경하여 운영
