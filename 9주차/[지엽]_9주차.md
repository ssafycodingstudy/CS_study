## 로드밸런싱

컴퓨터 네트워크 기술의 일종으로 둘 or 셋 이상의 중앙 처리 장치와 같은 컴퓨터 자원들에게 작업을 나누는 것

-> 여러 서버가 분산 처리 하는 것



#### 로드 밸런싱의 종류

OSI 7계층에 따라 종류가 나뉨

![img](https://cdn-ssl-devio-img.classmethod.jp/wp-content/uploads/2021/06/434.png)



- L2 : Data link 계층을 사용, Mac 주소 기반 부하 분산

- L3 : Network 계층을 사용, IP 주소 기반 부하 분산

- L4 : Transport 계층을 사용, IP 주소와 포트 번호 부하 분산

- L7 : Application 계층을 사용, URL 또는 HTTP 헤더에서 부하 분산



#### NLB(Network LoadBalancer)와 ALB(Application LoadBalancer)의 차이

##### NLB

![img](https://cdn-ssl-devio-img.classmethod.jp/wp-content/uploads/2021/06/05c484eab6489d4c5e0d3b1f6048397b.jpeg)

- client IP와 서버 사이에 서버로 들어오는 트래픽은 Load Balancer를 통하고 나가는 트래픽은 Client IP와 직접 통신

- NLB는 Security Group 적용이 되지 않아서 서버에 적용된 Security Group에서 보안이 가능

- Client -> Server에서 Access 제한 가능

- NLB는 할당한 Elastic IP를 Static IP로 사용이 가능하여 DNS Name과 IP 주소 모두 사용이 가능

- Name Server 또는 Route 53에서 A Record 사용이 가능

##### ALB

![img](https://cdn-ssl-devio-img.classmethod.jp/wp-content/uploads/2021/06/dd.jpeg)

- Reverse Proxy 대로 Client IP와 서버 사이에 들어오고 낙가는 트래픽이 모두 Load Balancer와 통신

- CLB/ALB는 Security Group 을 통한 보안이 가능

- Client → Load Balancer의 Access 제한 가능

- ALB/CLB는 IP 주소가 변동되기 때문에 Client 에서 Access 할 ELB의 DNS Name을 이용해야 함

- Name Server 또는 Route 53에서 CNAME 을 사용해야 Domain Name 연동이 가능



#### Load Balancing Algorithm 종류 

- Round Robin
  - 요청이 들어오는 대로 서버마다 균등하게 요청을 분배 가장 단순한 분배 방식

 

- Weighted Round Robin Scheduling

  - Round Robin방식으로 분배하지만 서버의 가중치에 따라 요청을 더 분배하거나 덜 분배함

  - 서버 가중치는 사용자가 지정할 수 있고 동적으로 조정



- Least Connection
  - 서버마다 연결된 커넥션이 몇개인지 체크하여 커넥션이 가장 적은 서버로 요청을 분배

 

- Weighted Least Connections

  - Least Connection방식으로 분배하지만 서버 가중치에 따라 요청을 더 분배하거나 덜 분배함

  - 서버 가중치는 사용자가 지정할 수 있고 동적으로 조정

  - 서버 풀에 존재하는 서버들의 사양이 일관적이지 않고 다양한 경우 이 방법이 효과

 

- Fastest Response Time
  - 서버가 요청에 대해 응답하는 시간을 체크하여 가장 빠른 서버로 요청을 분배

 

- Source Hash Scheduling

  - 사용자의 IP를 해싱한 후 그 결과에 따라 서버로 요청을 분배

  - 사용자의 IP는 고정되어 있기 때문에 항상 같은 서버로 연결된다는 보장을 받음



## 블록/논블록,동기/비동기

#### 블록/논블록 - 함수호출에서의 이야기, 기술적으로 구분

block

- 호출된 함수가 자신이 할 일을 모두 마칠 때까지 제어권을 계속 가지고서 호출한 함수에게 바로  리턴하지 않으면 블럭

Non-block 

- 호출된 함수가 할 일을 마치지 않더라도 제어권을 리턴하여 호출한 함숙가 다른 일을 진행할 수 있도록 하면 논블록

#### 동기/비동기 행위에 대한 이야기, 기술적으론 구분되지 않음

동기

- 호출된 함수의 수행 결과 및 종료를 호출된 함수 뿐 아니라 호출한 함수도 함께 처리하면 동기

비동기

- 호출된 함수의 수행 결과 및 종료를 호출된 함수 혼자 직접 처리하면 비동기

![img](https://media.vlpt.us/images/kjh3865/post/c7021130-58df-44e8-813f-466bafac56d6/2021-03-07T20_37_39.png)

#### 블럭 & 동기

```
손님: 아메리카 주문
직원: 아메리카노 만드는중
손님: (그 자리에 서서 기다리는중. 결과가 궁금함. 테이블 못가고 서있음.)
```

#### 블럭 & 비동기

```
손님: 아메리카노 주문
직원 : 아메리카노 만드는중
손님 : (안궁금함. 테이블에 가고싶지만 못가고 서있음.)
```

블록 & 비동기는 결국 다른 작업이 끝날 때를 기다려야 하기 때문에 블록 & 동기와 비슷한 효율이 나옴

#### 논블록 & 동기

```
손님: 아메리카노 주문
직원 : 아메리카노 만드는중
손님 : 재촉
```

논블록으로 자신의 작업을 계속하고 있지만 다른 작업과의 동기를 위해 계속해서 다른 작업이 끝났는지 조회

호출된 함수가 호출한 함수에게 제어권을 바로 리턴하여 호출한 함수가 다른 업무를 볼 수 있었지만 여전히 호출된 함수의 업무 결과에 관여하느라 제 할일을 못함

효율이 좋지 않음

#### 논블록 & 비동기

```
손님: 아메리카노 주문
직원 : 아메리카노 만드는중
손님 : 자리가서 SNS, 유튜브 시청
직원 : 아메리카노 제작 완료
```

자원이 충분하면 효율이 좋음

자신의 작업이 멈추지도 않고 다른 주체가 하는 작업의 결과가 나왔을 때 콜백을 설정

작업을 맡겨놓고 하던 일을 계속 할 수 있기 때문에 해야 할 작업이 대규모이고 동기가 필요없을 때 효과적.

[참고]

https://dev.classmethod.jp/articles/load-balancing-types-and-algorithm/

https://deveric.tistory.com/91

https://velog.io/@leehyunho2001/%EB%8F%99%EA%B8%B0-%EB%B9%84%EB%8F%99%EA%B8%B0-%EB%B8%94%EB%9F%AD-%EB%84%8C%EB%B8%94%EB%9F%AD