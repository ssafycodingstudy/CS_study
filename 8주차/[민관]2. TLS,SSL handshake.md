### SSL/TLS Handshake란?

- 통신을 하는 브라우저와 웹 서버가 서로 암호화 통신을 시작할 수 잇도록 신분을 확인하고 필요한 정보를 클라이언트와 서버가 주거니 받거니 하는 과정

### 동작 과정

![3](https://user-images.githubusercontent.com/44665707/154791567-ad48f8a3-c6ea-4ab2-a881-3f0d17a5f38d.PNG)

- 각 칸들은 네트워크 상에서 전달되는 IP 패킷들, 파란색은 TCP 레이어의 3-way Handshake. SSL Handshake에 앞서 연결 생성
- 노란색 칸들이 SSL Handshake에 해당하는 패킷

1. CA

   - 인증서의 역할은 클라이언트가 접속한 서버가 의도한 서버가 맞는지 보장하는 것
   - 이 역할을 하는 기업들을 CA(Certificate Authority)라고 함, HTTPS를 적용하려면 CA 기업의 인증서 구입 필요

2. ClientHello

   - 클라이언트가 서버에 연결을 시도하며 전송하는 패킷
   - 자신이 사용 가능한 Cipher Suite 목록, Session ID, SSL 프로토콜 버전, Random Byte 등을 전달
   - Cipher Suite는 SSL 프로토콜 버전, 인증서 검정, 데이터 암호화 프로토콜, Hash 방식 등의 정보를 담고 있는 존재
   - 선택된 Cipher Suite의 알고리즘에 따라 데이터를 암호화

   ![4](https://user-images.githubusercontent.com/44665707/154791662-a2e0768b-d3ad-4fd6-b800-a50919967b1e.PNG)

3. ServerHllo

   - 서버는 클라이언트가 보내 온 ClientHello 패킷을 받아 Cipher Suite 중 하나를 선택한 다음 클라이언트에게 이를 알림
   - 자신의 SSL 프로토콜 버전 등도 같이 보냄

4. Certificate

   - Server가 자신의 SSL 인증서를 클라이언트에 전달, 인증서 내부에는 Server가 발행한 공개 키가 들어있음
   - 클라이언트는 서버가 보낸 CA의 개인 키로 암호화된 이 SSL 인증서를 이미 모두에게 공개된 CA의 공개 키를 사용해 복호화

5. Server Key Exchange / ServerHello Done

   - 서버의 공개 키가 SSL 인증서 내부에 없는 경우, 서버가 직접 전달한다는 뜻
   - 공개 키가 SSL 인증서 내부에 있으면 생략

6. Client Key Exchange

   - 클라이언트는 데이터 암호화에 사용할 대칭 키를 생성한 후 SSL 인증서 내부에서 추출한 서버의 공개 키 이용해 암호화한 후 서버에 전달
   - 여기서 전달된 대칭 키가 SSL Handshake의 목적이자 가장 중요한 수단인 데이터를 실제로 암호화할 대칭 키

7. ChangeCipherSpec / Finished

   - 클라이언트와 서버 모두가 서로에게 보내는 패킷, 통신할 준비가 다 됐음을 알리는 패킷
   - Finished 패킷 보내어 SSL Handshake 종료
